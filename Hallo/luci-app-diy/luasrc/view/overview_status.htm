</style>

<div class="centered-table">
<table>
<caption><h2>路由状态总览</h2></caption>
<tr>
<th>机型</th>
<td><%=luci.sys.exec("cat /proc/cpuinfo | grep 'machine' | awk -F':' '{print $2}'")%></td>
</tr>
<tr>
<th>序列号>xue'
<td><%=luci.sys.exec("UUID_FILE=/etc/router_uuid; if [ ! -f $UUID_FILE ]; then # 优先读取MTD分区标识（兼容性极强） MTD_ID=$(cat /sys/class/mtd/mtd0/uuid 2>/dev/null || cat /sys/class/mtd/mtd0/size 2>/dev/null || cat /sys/class/mtd/mtd0/name 2>/dev/null) # 若MTD标识读取失败，自动切换到CPU信息（兜底，支持所有设备） UNIQUE_ID=${MTD_ID:-$(cat /proc/cpuinfo | grep -E 'model name|Serial' | tr -d ' \n:' 2>/dev/null)} # 组合唯一标识和内核随机数生成UUID echo -n \"$UNIQUE_ID-$(cat /proc/sys/kernel/random/uuid 2>/dev/null)\" | md5sum | awk '{print $1}' > $UUID_FILE; fi; cat $UUID_FILE 2>/dev/null || echo 'ba0zaw1a03a09b0907c02030an08c56kj01'")%></td>
</tr>
<tr>
<th>外网接口状态</th>
<td>
<% if luci.sys.exec("ip link show dev eth1 | grep 'state UP'") ~= "" then %>
    <span style="color: rgb(13, 221, 13);">物理wan口已连接</span>
    <tr>
    <th>WAN口拨号协议</th>
    <td><%=luci.sys.exec("uci get network.wan.proto")%></td>
    </tr>
<% else %>
    <% if luci.sys.exec("iw dev | awk '/Interface/ {name=$2} /type managed/ {print name; exit}'") ~= "" then %>
        <span style="color: rgb(13, 221, 13);"><%= luci.sys.exec("iw dev | awk '/Interface/ {name=$2} /type managed/ {print name; exit}'") %>已连接:<%=luci.sys.exec("iw dev $(iw dev | awk '/Interface/ {name=$2} /type managed/ {print name; exit}') link | awk '/tx bitrate:/ {upload=$3} /rx bitrate:/ {download=$3} END {print \"↑ \" upload \" MBit/s / ↓ \" download \" MBit/s\"}'")%></span>
    <% else %>
        <span style="color: red;">未连接</span>
    <% end %>
<% end %>
</td>
<tr>
  <th>网络连接状态</th>
  <td>
    <span id="network-status">
      <% if luci.sys.call("ping -c 1 182.254.116.116 > /dev/null") == 0 then %>
        <span style="color: rgb(13, 221, 13);">已连接到互联网</span>
      <% else %>
        <span style="color: red;">网络异常</span>
      <% end %>
    </span>
  </td>
</tr>
<tr>
<th>日期</th>
<td><%=os.date("%Y-%m-%d")%></td>
</tr>
<tr>
<th>开机时间</th>
<td><%=luci.sys.exec("uptime -s")%></td>
</tr>
<tr>
<th>累计运行时间</th>
<td><%
local file = io.open("/proc/uptime", "r")
if file then
    local uptime = file:read("*n")
    file:close()
    local days = math.floor(uptime / 86400)
    local hours = math.floor((uptime % 86400) / 3600)
    local minutes = math.floor((uptime % 3600) / 60)
    local seconds = math.floor(uptime % 60)
    print(string.format("%d天 %02d时 %02d分 %02d秒", days, hours, minutes, seconds))
else
    print("无法获取累计运行时间")
end
%></td>
</tr>
<tr>
<th>已连接路由器数量</th>
<td><%=luci.sys.exec("iw dev | awk '/Interface/ {print $2}' | while read iface; do iw dev $iface station dump | grep 'Station' | wc -l; done | awk '{sum += $1} END {print sum}'")%></td>
</tr>
</table>
</div>
